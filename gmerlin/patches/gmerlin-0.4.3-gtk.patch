diff -up gmerlin-0.4.3/apps/visualizer/gmerlin_visualizer.c.orig gmerlin-0.4.3/apps/visualizer/gmerlin_visualizer.c
--- gmerlin-0.4.3/apps/visualizer/gmerlin_visualizer.c.orig	2010-01-14 16:35:05.000000000 -0200
+++ gmerlin-0.4.3/apps/visualizer/gmerlin_visualizer.c	2010-11-14 12:36:04.260651984 -0200
@@ -387,7 +387,7 @@ static void grab_notify_callback(GtkWidg
   visualizer_t * win = (visualizer_t*)data;
   if(!was_grabbed)
     {
-    GTK_WIDGET_SET_FLAGS(win->current_window->socket, GTK_CAN_FOCUS);
+    bg_gtk_widget_set_can_focus(win->current_window->socket, TRUE);
     gtk_widget_grab_focus(win->current_window->socket);
     }
   }
@@ -457,7 +457,7 @@ static void plug_added_callback(GtkWidge
   gtk_widget_hide(v->toolbar);
   
   /* Seems that this is switched off, when an earlier client exited */
-  GTK_WIDGET_SET_FLAGS(w, GTK_CAN_FOCUS);
+  bg_gtk_widget_set_can_focus(w, TRUE);
   gtk_widget_grab_focus(w);
   }
 
diff -up gmerlin-0.4.3/lib/gtk/auth.c.orig gmerlin-0.4.3/lib/gtk/auth.c
--- gmerlin-0.4.3/lib/gtk/auth.c.orig	2010-01-14 16:35:05.000000000 -0200
+++ gmerlin-0.4.3/lib/gtk/auth.c	2010-11-14 12:37:31.766832785 -0200
@@ -80,8 +80,8 @@ static userpass_win * userpass_win_creat
   ret->ok_button = gtk_button_new_from_stock(GTK_STOCK_OK);
   ret->cancel_button = gtk_button_new_from_stock(GTK_STOCK_CANCEL);
 
-  GTK_WIDGET_SET_FLAGS(ret->ok_button, GTK_CAN_DEFAULT);
-  GTK_WIDGET_SET_FLAGS(ret->cancel_button, GTK_CAN_DEFAULT);
+  bg_gtk_widget_set_can_default(ret->ok_button, TRUE);
+  bg_gtk_widget_set_can_default(ret->cancel_button, TRUE);
   
   g_signal_connect(G_OBJECT(ret->ok_button),
                    "clicked", G_CALLBACK(button_callback), ret);
diff -up gmerlin-0.4.3/lib/gtk/cfg_dialog.c.orig gmerlin-0.4.3/lib/gtk/cfg_dialog.c
--- gmerlin-0.4.3/lib/gtk/cfg_dialog.c.orig	2010-01-14 16:35:05.000000000 -0200
+++ gmerlin-0.4.3/lib/gtk/cfg_dialog.c	2010-11-14 12:38:20.197310356 -0200
@@ -398,9 +398,9 @@ static bg_dialog_t * create_dialog(const
   ret->close_button = gtk_button_new_from_stock(GTK_STOCK_CLOSE);
   ret->ok_button    = gtk_button_new_from_stock(GTK_STOCK_OK);
 
-  GTK_WIDGET_SET_FLAGS(ret->apply_button, GTK_CAN_DEFAULT);
-  GTK_WIDGET_SET_FLAGS(ret->close_button, GTK_CAN_DEFAULT);
-  GTK_WIDGET_SET_FLAGS(ret->ok_button, GTK_CAN_DEFAULT);
+  bg_gtk_widget_set_can_default(ret->apply_button, TRUE);
+  bg_gtk_widget_set_can_default(ret->close_button, TRUE);
+  bg_gtk_widget_set_can_default(ret->ok_button, TRUE);
   
   gtk_window_set_modal(GTK_WINDOW(ret->window), TRUE);
   
@@ -413,9 +413,9 @@ static bg_dialog_t * create_dialog(const
   g_signal_connect(G_OBJECT(ret->window), "delete_event",
                      G_CALLBACK(delete_callback), (gpointer)ret);
 
-  GTK_WIDGET_SET_FLAGS (ret->close_button, GTK_CAN_DEFAULT);
-  GTK_WIDGET_SET_FLAGS (ret->apply_button, GTK_CAN_DEFAULT);
-  GTK_WIDGET_SET_FLAGS (ret->ok_button, GTK_CAN_DEFAULT);
+  bg_gtk_widget_set_can_default(ret->close_button, TRUE);
+  bg_gtk_widget_set_can_default(ret->apply_button, TRUE);
+  bg_gtk_widget_set_can_default(ret->ok_button, TRUE);
   
   gtk_widget_show(ret->apply_button);
   gtk_widget_show(ret->close_button);
diff -up gmerlin-0.4.3/lib/gtk/driveselect.c.orig gmerlin-0.4.3/lib/gtk/driveselect.c
--- gmerlin-0.4.3/lib/gtk/driveselect.c.orig	2010-01-14 16:35:05.000000000 -0200
+++ gmerlin-0.4.3/lib/gtk/driveselect.c	2010-11-14 12:38:44.909430929 -0200
@@ -192,8 +192,8 @@ bg_gtk_drivesel_create(const char * titl
   ret->add_button = gtk_button_new_from_stock(GTK_STOCK_ADD);
   ret->close_button = gtk_button_new_from_stock(GTK_STOCK_CLOSE);
 
-  GTK_WIDGET_SET_FLAGS(ret->close_button, GTK_CAN_DEFAULT);
-  GTK_WIDGET_SET_FLAGS(ret->add_button, GTK_CAN_DEFAULT);
+  bg_gtk_widget_set_can_default(ret->close_button, TRUE);
+  bg_gtk_widget_set_can_default(ret->add_button, TRUE);
   
   /* Set callbacks */
 
diff -up gmerlin-0.4.3/lib/gtk/gtkutils.c.orig gmerlin-0.4.3/lib/gtk/gtkutils.c
--- gmerlin-0.4.3/lib/gtk/gtkutils.c.orig	2010-01-14 16:35:05.000000000 -0200
+++ gmerlin-0.4.3/lib/gtk/gtkutils.c	2010-11-14 12:36:04.259652207 -0200
@@ -465,7 +465,7 @@ GtkWidget * bg_gtk_get_toplevel(GtkWidge
     return (GtkWidget*)0;
   
   toplevel = gtk_widget_get_toplevel(w);
-  if(!GTK_WIDGET_TOPLEVEL (toplevel))
+  if(!bg_gtk_widget_is_toplevel(toplevel))
     toplevel = (GtkWidget*)0;
   return toplevel;
   }
@@ -508,3 +508,45 @@ GdkPixbuf * bg_gtk_pixbuf_from_frame(gav
   else
     return NULL;
   }
+
+int bg_gtk_widget_is_realized(GtkWidget * w)
+  {
+#if GTK_CHECK_VERSION(2,20,0)
+  return gtk_widget_get_realized(w);
+#else
+  return GTK_WIDGET_REALIZED(w);
+#endif
+  }
+
+int bg_gtk_widget_is_toplevel(GtkWidget * w)
+  {
+#if GTK_CHECK_VERSION(2,18,0)
+  return gtk_widget_is_toplevel(w);
+#else
+  return GTK_WIDGET_TOPLEVEL(w);
+#endif
+  }
+
+void bg_gtk_widget_set_can_default(GtkWidget *w, gboolean can_default)
+  {
+#if GTK_CHECK_VERSION(2,18,0)
+  gtk_widget_set_can_default(w, can_default);
+#else
+  if(can_default)
+    GTK_WIDGET_SET_FLAGS(w, GTK_CAN_DEFAULT);
+  else
+    GTK_WIDGET_UNSET_FLAGS(w, GTK_CAN_DEFAULT);
+#endif
+  }
+
+void bg_gtk_widget_set_can_focus(GtkWidget *w, gboolean can_focus)
+  {
+#if GTK_CHECK_VERSION(2,18,0)
+  gtk_widget_set_can_focus(w, can_focus);
+#else
+  if(can_focus)
+    GTK_WIDGET_SET_FLAGS(w, GTK_CAN_FOCUS);
+  else
+    GTK_WIDGET_UNSET_FLAGS(w, GTK_CAN_FOCUS);
+#endif
+  }
diff -up gmerlin-0.4.3/lib/gtk/message.c.orig gmerlin-0.4.3/lib/gtk/message.c
--- gmerlin-0.4.3/lib/gtk/message.c.orig	2010-01-14 16:35:05.000000000 -0200
+++ gmerlin-0.4.3/lib/gtk/message.c	2010-11-14 12:36:04.262651509 -0200
@@ -86,7 +86,7 @@ void bg_gtk_message(const char * message
   gtk_window_set_modal(GTK_WINDOW(q->window), 1);
   gtk_window_set_title(GTK_WINDOW(q->window), TR("Message"));
   gtk_window_set_position(GTK_WINDOW(q->window), GTK_WIN_POS_CENTER_ON_PARENT);
-  GTK_WIDGET_SET_FLAGS (q->ok_button, GTK_CAN_DEFAULT);
+  bg_gtk_widget_set_can_default(q->ok_button, TRUE);
 
   gtk_label_set_justify(GTK_LABEL(label), GTK_JUSTIFY_CENTER);
   
diff -up gmerlin-0.4.3/lib/gtk/multiinfo.c.orig gmerlin-0.4.3/lib/gtk/multiinfo.c
--- gmerlin-0.4.3/lib/gtk/multiinfo.c.orig	2010-01-14 16:35:05.000000000 -0200
+++ gmerlin-0.4.3/lib/gtk/multiinfo.c	2010-11-14 12:36:04.262651509 -0200
@@ -77,7 +77,7 @@ multiwindow_create(const char * title, c
   /* Create close button */
 
   ret->close_button = gtk_button_new_from_stock(GTK_STOCK_CLOSE);
-  GTK_WIDGET_SET_FLAGS(ret->close_button, GTK_CAN_DEFAULT);
+  bg_gtk_widget_set_can_default(ret->close_button, TRUE);
 
   g_signal_connect(G_OBJECT(ret->close_button), "clicked",
                    G_CALLBACK(button_callback), (gpointer)ret);
diff -up gmerlin-0.4.3/lib/gtk/plugininfo.c.orig gmerlin-0.4.3/lib/gtk/plugininfo.c
--- gmerlin-0.4.3/lib/gtk/plugininfo.c.orig	2010-02-14 00:39:15.000000000 -0200
+++ gmerlin-0.4.3/lib/gtk/plugininfo.c	2010-11-14 12:36:04.263651270 -0200
@@ -79,7 +79,7 @@ pluginwindow_create(const char * title,
   /* Create close button */
 
   ret->close_button = gtk_button_new_from_stock(GTK_STOCK_CLOSE);
-  GTK_WIDGET_SET_FLAGS(ret->close_button, GTK_CAN_DEFAULT);
+  bg_gtk_widget_set_can_default(ret->close_button, TRUE);
 
   g_signal_connect(G_OBJECT(ret->close_button), "clicked",
                    G_CALLBACK(button_callback), (gpointer)ret);
diff -up gmerlin-0.4.3/lib/gtk/question.c.orig gmerlin-0.4.3/lib/gtk/question.c
--- gmerlin-0.4.3/lib/gtk/question.c.orig	2010-01-14 16:35:05.000000000 -0200
+++ gmerlin-0.4.3/lib/gtk/question.c	2010-11-14 12:36:04.263651270 -0200
@@ -92,8 +92,8 @@ int bg_gtk_question(const char * questio
   gtk_window_set_modal(GTK_WINDOW(q->window), 1);
   gtk_window_set_title(GTK_WINDOW(q->window), TR("Question"));
   gtk_window_set_position(GTK_WINDOW(q->window), GTK_WIN_POS_CENTER_ON_PARENT);
-  GTK_WIDGET_SET_FLAGS (q->ok_button, GTK_CAN_DEFAULT);
-  GTK_WIDGET_SET_FLAGS (q->cancel_button, GTK_CAN_DEFAULT);
+  bg_gtk_widget_set_can_default(q->ok_button, TRUE);
+  bg_gtk_widget_set_can_default(q->cancel_button, TRUE);
 
   gtk_label_set_justify(GTK_LABEL(label), GTK_JUSTIFY_CENTER);
   
diff -up gmerlin-0.4.3/lib/gtk/textwindow.c.orig gmerlin-0.4.3/lib/gtk/textwindow.c
--- gmerlin-0.4.3/lib/gtk/textwindow.c.orig	2010-02-14 00:39:15.000000000 -0200
+++ gmerlin-0.4.3/lib/gtk/textwindow.c	2010-11-14 12:36:04.263651270 -0200
@@ -75,7 +75,7 @@ bg_gtk_textwindow_create(const char * te
   /* Create close button */
 
   ret->close_button = gtk_button_new_from_stock(GTK_STOCK_CLOSE);
-  GTK_WIDGET_SET_FLAGS(ret->close_button, GTK_CAN_DEFAULT);
+  bg_gtk_widget_set_can_default(ret->close_button, TRUE);
 
   g_signal_connect(G_OBJECT(ret->close_button), "clicked",
                    G_CALLBACK(button_callback), (gpointer)ret);
diff -up gmerlin-0.4.3/lib/gtk/treewidget.c.orig gmerlin-0.4.3/lib/gtk/treewidget.c
--- gmerlin-0.4.3/lib/gtk/treewidget.c.orig	2010-01-14 16:35:05.000000000 -0200
+++ gmerlin-0.4.3/lib/gtk/treewidget.c	2010-11-14 12:36:04.264651031 -0200
@@ -1853,7 +1853,11 @@ static void tree_changed_callback(bg_med
 
   }
 
+#if GTK_CHECK_VERSION(2, 21, 6)
+static void notebook_change_page(GtkWidget * widget, gpointer page, int num, gpointer data)
+#else
 static void notebook_change_page(GtkWidget * widget, GtkNotebookPage *page, int num, gpointer data)
+#endif
   {
   bg_gtk_tree_widget_t * wid;
   bg_gtk_album_window_t * win;
diff -up gmerlin-0.4.3/lib/gtk/urlselect.c.orig gmerlin-0.4.3/lib/gtk/urlselect.c
--- gmerlin-0.4.3/lib/gtk/urlselect.c.orig	2010-01-14 16:35:05.000000000 -0200
+++ gmerlin-0.4.3/lib/gtk/urlselect.c	2010-11-14 12:39:16.335954134 -0200
@@ -152,8 +152,8 @@ bg_gtk_urlsel_create(const char * title,
   ret->add_button = gtk_button_new_from_stock(GTK_STOCK_ADD);
   ret->close_button = gtk_button_new_from_stock(GTK_STOCK_CLOSE);
 
-  GTK_WIDGET_SET_FLAGS(ret->close_button, GTK_CAN_DEFAULT);
-  GTK_WIDGET_SET_FLAGS(ret->add_button, GTK_CAN_DEFAULT);
+  bg_gtk_widget_set_can_default(ret->close_button, TRUE);
+  bg_gtk_widget_set_can_default(ret->add_button, TRUE);
     
   /* Set callbacks */
 
diff -up gmerlin-0.4.3/lib/gtk/vumeter.c.orig gmerlin-0.4.3/lib/gtk/vumeter.c
--- gmerlin-0.4.3/lib/gtk/vumeter.c.orig	2010-01-14 16:35:05.000000000 -0200
+++ gmerlin-0.4.3/lib/gtk/vumeter.c	2010-11-14 12:36:04.259652207 -0200
@@ -687,7 +687,8 @@ static void draw_dynamic(bg_gtk_vumeter_
   {
   int i;
 
-  if(!GTK_WIDGET_REALIZED(m->layout) || !m->pixmap_width || !m->pixmap_height)
+  if(!bg_gtk_widget_is_realized(m->layout) ||
+     !m->pixmap_width || !m->pixmap_height)
     return;
   
   if(!m->pixmaps_valid)
