From d5ca371eb5b7ebf9f008fec7d905f53b9f4e16c3 Mon Sep 17 00:00:00 2001
From: Bastien Nocera <hadess@hadess.net>
Date: Mon, 22 Mar 2010 16:42:10 +0000
Subject: [PATCH] Don't load AFC devices using the MTP plugin

They should be handled by the iPod plugin instead.

https://bugzilla.gnome.org/show_bug.cgi?id=613606
---
 plugins/mtpdevice/rb-mtp-plugin.c |    6 ++++++
 1 files changed, 6 insertions(+), 0 deletions(-)

diff --git a/plugins/mtpdevice/rb-mtp-plugin.c b/plugins/mtpdevice/rb-mtp-plugin.c
index fdb9df8..43a4b15 100644
--- a/plugins/mtpdevice/rb-mtp-plugin.c
+++ b/plugins/mtpdevice/rb-mtp-plugin.c
@@ -343,6 +343,12 @@ create_source_device_cb (RBRemovableMediaManager *rmm, GObject *device_obj, RBMt
 		return NULL;
 	}
 
+	/* check that it's not an iPhone or iPod Touch */
+	if (g_udev_device_get_property_as_boolean (device, "USBMUX_SUPPORTED")) {
+		rb_debug ("device %s is supported through AFC, ignore", g_udev_device_get_name (device));
+		return NULL;
+	}
+
 	device_number = g_udev_device_get_device_number (device);
 	if (device_number == 0) {
 		rb_debug ("can't get udev device number for device %s", g_udev_device_get_name (device));
-- 
1.7.0.1

