From 73dfec85365498bcf8773db7431c3f384638493e Mon Sep 17 00:00:00 2001
From: Fabrice Bellet <fabrice@bellet.info>
Date: Fri, 20 Jul 2012 14:32:32 +0200
Subject: [PATCH 4/4] check to be sure that %n is not being set as format type
 (CVE-2012-2090)

---
 simgear/scene/model/SGText.cxx | 10 ++++++++++
 1 file changed, 10 insertions(+)

diff --git a/simgear/scene/model/SGText.cxx b/simgear/scene/model/SGText.cxx
index e87b48a..f0a7518 100644
--- a/simgear/scene/model/SGText.cxx
+++ b/simgear/scene/model/SGText.cxx
@@ -65,6 +65,16 @@ void SGText::UpdateCallback::operator()(osg::Node * node, osg::NodeVisitor *nv )
   // FIXME:
   // hopefully the users never specifies bad formats here
   // this should better be something more robust
+  // It is never safe for format.c_str to be %n.
+  string unsafe ("%n");
+  size_t found;
+
+  found=format.find(unsafe);
+  if (found!=string::npos) {
+     SG_LOG(SG_GENERAL, SG_ALERT, "format type contained %n, but this is unsafe, reverting to %s");
+     format = "%s";
+  }
+
   char buf[256];
   if( numeric ) {
     double d = property->getDoubleValue() * scale + offset;
-- 
1.7.11.4

