From 971ca2c0270ad00020f99b6f58e362bdee89d21c Mon Sep 17 00:00:00 2001
From: Fabrice Bellet <fabrice@bellet.info>
Date: Sun, 22 Jan 2012 14:41:59 +0100
Subject: [PATCH 2/4] nuke old bundled copy of expat, use system expat

---
 CMakeLists.txt               |  4 +++-
 simgear/CMakeLists.txt       |  2 +-
 simgear/props/CMakeLists.txt |  4 +++-
 simgear/xml/CMakeLists.txt   | 19 -------------------
 simgear/xml/easyxml.cxx      |  2 +-
 5 files changed, 8 insertions(+), 23 deletions(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index 28f624c..e5d58ab 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -147,6 +147,7 @@ endif(ENABLE_LIBSVN)
 
 find_package(ZLIB REQUIRED)
 find_package(Threads REQUIRED)
+find_package(EXPAT REQUIRED)
 
 check_include_file(sys/time.h HAVE_SYS_TIME_H)
 check_include_file(sys/timeb.h HAVE_SYS_TIMEB_H)
@@ -249,7 +250,8 @@ include_directories(${PROJECT_BINARY_DIR}/simgear/xml)
 
 include_directories(${OPENSCENEGRAPH_INCLUDE_DIRS} 
     ${Boost_INCLUDE_DIRS} ${ZLIB_INCLUDE_DIR} 
-    ${ALUT_INCLUDE_DIR} ${OPENAL_INCLUDE_DIR} )
+    ${ALUT_INCLUDE_DIR} ${OPENAL_INCLUDE_DIR}
+    ${EXPAT_INCLUDE_DIR} )
 
 add_definitions(-DHAVE_CONFIG_H)
 add_definitions(-DHAVE_EXPAT_CONFIG_H)
diff --git a/simgear/CMakeLists.txt b/simgear/CMakeLists.txt
index 014b79d..db19b6c 100644
--- a/simgear/CMakeLists.txt
+++ b/simgear/CMakeLists.txt
@@ -54,7 +54,7 @@ if(SIMGEAR_SHARED)
     set_property(TARGET SimGearCore PROPERTY VERSION   ${SIMGEAR_VERSION})
     set_property(TARGET SimGearCore PROPERTY SOVERSION ${SIMGEAR_SOVERSION})
 
-    target_link_libraries(SimGearCore ${ZLIB_LIBRARY} ${RT_LIBRARY} ${CMAKE_THREAD_LIBS_INIT})
+    target_link_libraries(SimGearCore ${ZLIB_LIBRARY} ${RT_LIBRARY} ${CMAKE_THREAD_LIBS_INIT} ${EXPAT_LIBRARY})
     install(TARGETS SimGearCore LIBRARY DESTINATION ${CMAKE_INSTALL_LIBDIR})
 
     if(LIBSVN_FOUND)
diff --git a/simgear/props/CMakeLists.txt b/simgear/props/CMakeLists.txt
index a11e703..44f4eaf 100644
--- a/simgear/props/CMakeLists.txt
+++ b/simgear/props/CMakeLists.txt
@@ -28,7 +28,9 @@ if(ENABLE_TESTS)
 if (SIMGEAR_SHARED)
     set(TEST_LIBS SimGearCore)
 else()
-    set(TEST_LIBS sgprops sgxml sgstructure sgmisc sgdebug)
+    set(TEST_LIBS
+            sgprops sgxml sgstructure sgmisc sgdebug
+            ${EXPAT_LIBRARY})
 endif()
 
 
diff --git a/simgear/xml/CMakeLists.txt b/simgear/xml/CMakeLists.txt
index 0cb8d2c..e2dae9e 100644
--- a/simgear/xml/CMakeLists.txt
+++ b/simgear/xml/CMakeLists.txt
@@ -7,26 +7,7 @@ set(HEADERS
     )
     
 set(SOURCES 
-    asciitab.h
-    hashtable.h
-    iasciitab.h
-    latin1tab.h
-    nametab.h
-    utf8tab.h
-    xmldef.h
-    xmlparse.h
-    xmlrole.h
-    xmltok.h
-    xmltok_impl.h
-    hashtable.c
-    xmlparse.c
-    xmlrole.c
-    xmltok.c
     easyxml.cxx
-    internal.h
-    ascii.h
-    expat.h
-    expat_external.h
     )
 
 simgear_component(xml xml "${SOURCES}" "${HEADERS}")
diff --git a/simgear/xml/easyxml.cxx b/simgear/xml/easyxml.cxx
index 65a3551..0a5b617 100644
--- a/simgear/xml/easyxml.cxx
+++ b/simgear/xml/easyxml.cxx
@@ -9,7 +9,7 @@
 #include <string.h>		// strcmp()
 
 #include "easyxml.hxx"
-#include "xmlparse.h"
+#include <expat.h>
 
 #include <fstream>
 #include <iostream>
-- 
1.7.11.4

