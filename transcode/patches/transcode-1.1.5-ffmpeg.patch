diff -up transcode-1.1.5/export/export_ffmpeg.c.ffmpeg transcode-1.1.5/export/export_ffmpeg.c
--- transcode-1.1.5/export/export_ffmpeg.c.ffmpeg	2011-05-18 23:07:22.298862732 -0300
+++ transcode-1.1.5/export/export_ffmpeg.c	2011-05-18 23:07:50.460843618 -0300
@@ -643,8 +643,6 @@ MOD_init
 
     lavc_venc_context->bit_rate           = vob->divxbitrate * 1000;
     lavc_venc_context->bit_rate_tolerance = lavc_param_vrate_tolerance * 1000;
-    lavc_venc_context->mb_qmin            = lavc_param_mb_qmin;
-    lavc_venc_context->mb_qmax            = lavc_param_mb_qmax;
     lavc_venc_context->lmin= (int)(FF_QP2LAMBDA * lavc_param_lmin + 0.5);
     lavc_venc_context->lmax= (int)(FF_QP2LAMBDA * lavc_param_lmax + 0.5);
     lavc_venc_context->max_qdiff          = lavc_param_vqdiff;
diff -up transcode-1.1.5/import/decode_lavc.c.ffmpeg transcode-1.1.5/import/decode_lavc.c
--- transcode-1.1.5/import/decode_lavc.c.ffmpeg	2011-05-18 23:09:49.686365317 -0300
+++ transcode-1.1.5/import/decode_lavc.c	2011-05-18 23:16:16.739695424 -0300
@@ -120,6 +120,7 @@ void decode_lavc(decode_t *decode)
   char               *yuv2rgb_buffer = NULL;
   AVCodec            *lavc_dec_codec = NULL;
   AVCodecContext     *lavc_dec_context;
+  AVPacket           *pkt;
   int                 x_dim = 0, y_dim = 0;
   int                 pix_fmt, frame_size = 0, bpp = 8;
   struct ffmpeg_codec *codec;
@@ -261,8 +262,8 @@ void decode_lavc(decode_t *decode)
 
       //tc_log_msg(__FILE__, "SIZE: (%d) MP4(%d) blen(%d) BUF(%d) read(%ld)", len, mp4_size, buf_len, READ_BUFFER_SIZE, bytes_read);
       do {
-	  len = avcodec_decode_video(lavc_dec_context, &picture,
-		  &got_picture, buffer+buf_len, mp4_size-buf_len);
+	  len = avcodec_decode_video2(lavc_dec_context, &picture,
+		  &got_picture, pkt);
 
 	  if (len < 0) {
 	      tc_log_error(__FILE__, "frame decoding failed");
diff -up transcode-1.1.5/import/probe_ffmpeg.c.ffmpeg transcode-1.1.5/import/probe_ffmpeg.c
--- transcode-1.1.5/import/probe_ffmpeg.c.ffmpeg	2011-05-18 23:08:47.708609060 -0300
+++ transcode-1.1.5/import/probe_ffmpeg.c	2011-05-18 23:09:18.502028740 -0300
@@ -47,7 +47,7 @@ static void translate_info(const AVForma
     for (i = 0; i < ctx->nb_streams; i++) {
         st = ctx->streams[i];
 
-        if (st->codec->codec_type == CODEC_TYPE_VIDEO) {
+        if (st->codec->codec_type == AVMEDIA_TYPE_VIDEO) {
             info->bitrate = st->codec->bit_rate / 1000;
             info->width = st->codec->width;
             info->height = st->codec->height;
@@ -65,7 +65,7 @@ static void translate_info(const AVForma
     for (i = 0; i < ctx->nb_streams; i++) {
         st = ctx->streams[i];
 
-        if (st->codec->codec_type == CODEC_TYPE_AUDIO
+        if (st->codec->codec_type == AVMEDIA_TYPE_AUDIO
          && j < TC_MAX_AUD_TRACKS) {
             info->track[j].format = 0x1; /* known wrong */
             info->track[j].chan = st->codec->channels;
