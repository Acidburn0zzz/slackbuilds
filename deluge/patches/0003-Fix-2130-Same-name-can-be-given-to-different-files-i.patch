From ccd2e5e41d7b0127fc589b1e6bf6560894440ecd Mon Sep 17 00:00:00 2001
From: Calum Lind <calumlind+deluge@gmail.com>
Date: Wed, 5 Dec 2012 18:12:08 +0000
Subject: [PATCH 3/4] Fix #2130 : Same name can be given to different files in
 Add Torrent dialog

---
 deluge/ui/gtkui/addtorrentdialog.py | 5 ++++-
 1 file changed, 4 insertions(+), 1 deletion(-)

diff --git a/deluge/ui/gtkui/addtorrentdialog.py b/deluge/ui/gtkui/addtorrentdialog.py
index bc970ae..b9c8359 100644
--- a/deluge/ui/gtkui/addtorrentdialog.py
+++ b/deluge/ui/gtkui/addtorrentdialog.py
@@ -866,7 +866,10 @@ def _on_filename_edited(self, renderer, path, new_text):
                 return
             parent = self.files_treestore.iter_parent(itr)
             file_path = os.path.join(self.get_file_path(parent), new_text)
-
+            # Don't rename if filename exists
+            for row in self.files_treestore[parent].iterchildren():
+                if new_text == row[1] and row[3] > -1:
+                    return
             if os.path.sep in new_text:
                 # There are folders in this path, so we need to create them
                 # and then move the file iter to top
-- 
1.8.0.2

