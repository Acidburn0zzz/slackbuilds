X-Git-Url: http://git.savannah.gnu.org/gitweb/?p=gnash.git;a=blobdiff_plain;f=gui%2FPlayer.cpp;h=193dc861d0ffbb8b48e651b5d9d61c50a38da44a;hp=736fcceec0dc8519756468924f18900437375855;hb=3d603f00aa4be917fb6e43f2e265de885127f441;hpb=9794bea6121872eba958d25961bd10c5b901e0ba

diff --git a/gui/Player.cpp b/gui/Player.cpp
index 736fcce..193dc86 100644
--- a/gui/Player.cpp
+++ b/gui/Player.cpp
@@ -496,6 +496,9 @@ Player::run(int argc, char* argv[], cons
     // Now that we know about movie size, create gui window.
     _gui->createWindow(_url.c_str(), _width, _height, _xPosition, _yPosition);
 
+    { // we construct movie_root in its own scope, to be sure it's destroyed
+      // (bringing down the MovieLoader) before we clear the MovieLibrary
+
     movie_root root(*_movieDef, _gui->getClock(), *_runResources);
     
     _callbacksHandler.reset(new CallbacksHandler(*_gui, *this)); 
@@ -649,7 +652,10 @@ Player::run(int argc, char* argv[], cons
 
     log_debug("Main loop ended, cleaning up");
 
-    // Clean up as much as possible, so valgrind will help find actual leaks.
+    }
+
+    // Clean up the MovieLibrary so left-over SWFMovieDefinitions
+    // get destroyed and join any loader thread
     MovieFactory::clear();
 
 }

