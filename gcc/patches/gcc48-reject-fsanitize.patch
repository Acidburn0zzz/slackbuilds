From 65b20ceb41b0c6b175fa9c0a995a07c7aac44852 Mon Sep 17 00:00:00 2001
From: jakub <jakub@138bc75d-0d04-0410-961f-82ee72b054a4>
Date: Fri, 17 May 2013 12:24:26 +0000
Subject: [PATCH] 	* gcc.c (SANITIZER_SPEC): Reject -fsanitize=address -fsanitize=thread
 	linking.

git-svn-id: svn+ssh://gcc.gnu.org/svn/gcc/branches/gcc-4_8-branch@199010 138bc75d-0d04-0410-961f-82ee72b054a4
---
 gcc/ChangeLog |    3 +++
 gcc/gcc.c     |    3 ++-
 2 files changed, 5 insertions(+), 1 deletions(-)

diff --git a/gcc/ChangeLog b/gcc/ChangeLog
index 782f08e..970efc3 100644
--- a/gcc/ChangeLog
+++ b/gcc/ChangeLog
@@ -1,5 +1,8 @@
 2013-05-17  Jakub Jelinek  <jakub@redhat.com>
 
+	* gcc.c (SANITIZER_SPEC): Reject -fsanitize=address -fsanitize=thread
+	linking.
+
 	PR tree-optimization/57051
 	* fold-const.c (const_binop) <case VEC_LSHIFT_EXPR,
 	case VEC_RSHIFT_EXPR>: Fix BYTES_BIG_ENDIAN handling.
diff --git a/gcc/gcc.c b/gcc/gcc.c
index 86077f8..fea7394 100644
--- a/gcc/gcc.c
+++ b/gcc/gcc.c
@@ -716,7 +716,8 @@ proper position among the other output files.  */
 #ifndef SANITIZER_SPEC
 #define SANITIZER_SPEC "\
 %{!nostdlib:%{!nodefaultlibs:%{fsanitize=address:" LIBASAN_SPEC "\
-    %{static:%ecannot specify -static with -fsanitize=address}}\
+    %{static:%ecannot specify -static with -fsanitize=address}\
+    %{fsanitize=thread:%e-fsanitize=address is incompatible with -fsanitize=thread}}\
     %{fsanitize=thread:" LIBTSAN_SPEC "\
     %{!pie:%{!shared:%e-fsanitize=thread linking must be done with -pie or -shared}}}}}"
 #endif
-- 
1.7.1

