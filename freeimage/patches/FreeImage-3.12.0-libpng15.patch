--- Source/FreeImage/PluginPNG.cpp.png15	2011-11-09 20:37:10.457554194 -0200
+++ Source/FreeImage/PluginPNG.cpp	2011-11-09 20:37:31.927970983 -0200
@@ -37,6 +37,7 @@
 
 // ----------------------------------------------------------
 
+#include <zlib.h>
 #include <png.h>
 
 // ----------------------------------------------------------
@@ -323,7 +324,8 @@ Load(FreeImageIO *io, fi_handle handle,
 
 			png_read_info(png_ptr, info_ptr);
 			png_get_IHDR(png_ptr, info_ptr, &width, &height, &bit_depth, &color_type, NULL, NULL, NULL);
-			pixel_depth = info_ptr->pixel_depth;
+
+			pixel_depth = png_get_bit_depth(png_ptr, info_ptr) * png_get_channels(png_ptr, info_ptr);
 
 			// get image data type (assume standard image type)
 
@@ -543,7 +545,7 @@ Load(FreeImageIO *io, fi_handle handle,
 
 			if (png_get_valid(png_ptr, info_ptr, PNG_INFO_iCCP)) {
 				png_charp profile_name = NULL;
-				png_charp profile_data = NULL;
+				png_bytep profile_data = NULL;
 				png_uint_32 profile_length = 0;
 				int  compression_type;
 
@@ -802,7 +804,7 @@ Save(FreeImageIO *io, FIBITMAP *dib, fi_
 
 			FIICCPROFILE *iccProfile = FreeImage_GetICCProfile(dib);
 			if (iccProfile->size && iccProfile->data) {
-				png_set_iCCP(png_ptr, info_ptr, "Embedded Profile", 0, (png_charp)iccProfile->data, iccProfile->size);
+				png_set_iCCP(png_ptr, info_ptr, "Embedded Profile", 0, (png_const_bytep)iccProfile->data, iccProfile->size);
 			}
 
 			// write metadata
