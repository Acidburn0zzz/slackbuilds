--- libffmpegthumbnailer/moviedecoder.cpp.orig	2012-04-04 22:13:16.000000000 -0300
+++ libffmpegthumbnailer/moviedecoder.cpp	2012-04-04 22:17:01.639120933 -0300
@@ -58,13 +58,17 @@ MovieDecoder::~MovieDecoder()
 void MovieDecoder::initialize(const string& filename)
 {
     av_register_all();
+#if LIBAVCODEC_VERSION_INT < AV_VERSION_INT(54,0,0)
     avcodec_init();
+#endif
     avcodec_register_all();
 
     string inputFile = filename == "-" ? "pipe:" : filename;
     m_AllowSeek = (filename != "-") && (filename.find("rtsp://") != 0);
 
-    if ((!m_FormatContextWasGiven) && av_open_input_file(&m_pFormatContext, inputFile.c_str(), NULL, 0, NULL) != 0)
+    if ((!m_FormatContextWasGiven) && avformat_open_input(&m_pFormatContext, inputFile.c_str(), NULL, NULL) != 0)
+    
+    
     {
 		destroy();
         throw logic_error(string("Could not open input file: ") + filename);
@@ -90,7 +94,11 @@ void MovieDecoder::destroy()
 
     if ((!m_FormatContextWasGiven) && m_pFormatContext)
     {
+#if LIBAVCODEC_VERSION_INT < AV_VERSION_INT(54,0,0)
         av_close_input_file(m_pFormatContext);
+#else
+        avformat_close_input(&m_pFormatContext);
+#endif
         m_pFormatContext = NULL;
     }
 
