commit 9437d7700cff0331ccdcfff2875faa4a8b98cd82
Author: Stefan Br√ºns <stefan.bruens@rwth-aachen.de>
Date:   Sat Jan 11 17:32:59 2014 +0100

    kio bookmarks: Only iterate over element nodes in findToolbar()
    
    Only iterate over element nodes, and filter on <folder> tag.
    
    findFirstChild/nextSibling might return a node which is not an QDomElement. toElement will return NULL and accessing it will crash.
    
    Possible fix for 320006
    
    Acked by dfaure
    
    BUGS: 320006
    REVIEW: 113866

diff --git a/kio/bookmarks/kbookmark.cc b/kio/bookmarks/kbookmark.cc
index 8459a02..a258565 100644
--- a/kio/bookmarks/kbookmark.cc
+++ b/kio/bookmarks/kbookmark.cc
@@ -248,21 +248,12 @@ QDomElement KBookmarkGroup::findToolbar() const
 {
     if ( element.attribute("toolbar") == "yes" )
         return element;
-    for (QDomNode n = element.firstChild(); !n.isNull() ; n = n.nextSibling() )
+    for (QDomElement e = element.firstChildElement("folder"); !e.isNull();
+        e = e.nextSiblingElement("folder") )
     {
-        QDomElement e = n.toElement();
-        // Search among the "folder" children only
-        if ( e.tagName() == "folder" )
-        {
-            if ( e.attribute("toolbar") == "yes" )
-                return e;
-            else
-            {
-                QDomElement result = KBookmarkGroup(e).findToolbar();
-                if (!result.isNull())
-                    return result;
-            }
-        }
+        QDomElement result = KBookmarkGroup(e).findToolbar();
+        if (!result.isNull())
+            return result;
     }
     return QDomElement();
 }
