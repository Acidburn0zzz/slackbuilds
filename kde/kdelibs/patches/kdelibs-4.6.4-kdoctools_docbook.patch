diff -up kdelibs-4.6.4/kdoctools/CMakeLists.txt.kdoctools_docbook kdelibs-4.6.4/kdoctools/CMakeLists.txt
--- kdelibs-4.6.4/kdoctools/CMakeLists.txt.kdoctools_docbook	2011-04-01 08:55:50.000000000 -0500
+++ kdelibs-4.6.4/kdoctools/CMakeLists.txt	2011-06-27 09:36:41.976238333 -0500
@@ -217,9 +217,7 @@ add_custom_command( TARGET docbookl10nhe
   ${DOCBOOKXSL_DIR} ${CMAKE_CURRENT_SOURCE_DIR}/customization/xsl
   ${CMAKE_CURRENT_BINARY_DIR}/customization/xsl
 )
-# all-l10n.xml and kde-custom-l10n.xml are generated by docbookl10nhelper
+# all-l10n.xml is generated by docbookl10nhelper
 install(FILES ${CMAKE_CURRENT_BINARY_DIR}/customization/xsl/all-l10n.xml
   DESTINATION ${DATA_INSTALL_DIR}/ksgmltools2/customization/xsl/ )
-install(FILES ${CMAKE_CURRENT_BINARY_DIR}/customization/xsl/kde-custom-l10n.xml
-  DESTINATION ${DATA_INSTALL_DIR}/ksgmltools2/customization/xsl/ )
 
diff -up kdelibs-4.6.4/kdoctools/customization/kde-include-common.xsl.cmake.kdoctools_docbook kdelibs-4.6.4/kdoctools/customization/kde-include-common.xsl.cmake
--- kdelibs-4.6.4/kdoctools/customization/kde-include-common.xsl.cmake.kdoctools_docbook	2011-04-01 08:55:50.000000000 -0500
+++ kdelibs-4.6.4/kdoctools/customization/kde-include-common.xsl.cmake	2011-06-27 09:36:41.977238320 -0500
@@ -5,6 +5,5 @@
    <xsl:import href="@DOCBOOKXSL_DIR@/html/chunk.xsl"/>
 
    <xsl:param name="l10n.xml" select="document('xsl/all-l10n.xml')"/>
-   <xsl:param name="local.l10n.xml" select="document('xsl/kde-custom-l10n.xml')"/>
-        
+   <xsl:param name="local.l10n.xml" select="document(concat('xsl/',/*/@lang,'.xml'))"/>
 </xsl:stylesheet>
diff -up kdelibs-4.6.4/kdoctools/customization/kde-include-man.xsl.cmake.kdoctools_docbook kdelibs-4.6.4/kdoctools/customization/kde-include-man.xsl.cmake
--- kdelibs-4.6.4/kdoctools/customization/kde-include-man.xsl.cmake.kdoctools_docbook	2011-04-01 08:55:50.000000000 -0500
+++ kdelibs-4.6.4/kdoctools/customization/kde-include-man.xsl.cmake	2011-06-27 09:36:41.977238320 -0500
@@ -7,6 +7,5 @@
    <xsl:output method="text" encoding="UTF-8" indent="no"/>
 
    <xsl:param name="l10n.xml" select="document('xsl/all-l10n.xml')"/>
-   <xsl:param name="local.l10n.xml" select="document('xsl/kde-custom-l10n.xml')"/>
 
 </xsl:stylesheet>
diff -up kdelibs-4.6.4/kdoctools/customization/xsl/ca.xml.kdoctools_docbook kdelibs-4.6.4/kdoctools/customization/xsl/ca.xml
--- kdelibs-4.6.4/kdoctools/customization/xsl/ca.xml.kdoctools_docbook	2011-04-01 08:55:50.000000000 -0500
+++ kdelibs-4.6.4/kdoctools/customization/xsl/ca.xml	2011-06-27 09:36:41.977238320 -0500
@@ -1,6 +1,7 @@
-<?xml version="1.0" encoding="utf-8"?>
-<l:l10n xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" language="ca" english-language-name="Catalan">
+<l:i18n xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0">
+<l:l10n language="ca" english-language-name="Catalan">
    <l:gentext key="footer-doc-comment" text="Voleu fer un comentari o col&#183;laborar amb una actualitzaci&#243; d'aquesta p&#224;gina?"/>
    <l:gentext key="footer-doc-feedback" text="Envieu els comentaris a "/>
    <l:gentext key="footer-doc-teamname" text="l'equip de Documentaci&#243; del KDE"/>
 </l:l10n>
+</l:i18n>
diff -up kdelibs-4.6.4/kdoctools/customization/xsl/de.xml.kdoctools_docbook kdelibs-4.6.4/kdoctools/customization/xsl/de.xml
--- kdelibs-4.6.4/kdoctools/customization/xsl/de.xml.kdoctools_docbook	2011-04-01 08:55:50.000000000 -0500
+++ kdelibs-4.6.4/kdoctools/customization/xsl/de.xml	2011-06-27 09:36:41.978238308 -0500
@@ -1,6 +1,7 @@
-<?xml version="1.0" encoding="utf-8"?>
-<l:l10n xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" language="de" english-language-name="German">
+<l:i18n xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0">
+<l:l10n language="de" english-language-name="German">
    <l:gentext key="footer-doc-comment" text="M&#246;chten Sie Kommentare und Verbesserungen zu dieser Seite beitragen?"/>
    <l:gentext key="footer-doc-feedback" text="Senden Sie Ihre Vorschl&#228;ge an das "/>
    <l:gentext key="footer-doc-teamname" text="KDE Dokumentationsteam"/>
 </l:l10n>
+</l:i18n>
diff -up kdelibs-4.6.4/kdoctools/customization/xsl/el.xml.kdoctools_docbook kdelibs-4.6.4/kdoctools/customization/xsl/el.xml
--- kdelibs-4.6.4/kdoctools/customization/xsl/el.xml.kdoctools_docbook	2011-04-01 08:56:18.000000000 -0500
+++ kdelibs-4.6.4/kdoctools/customization/xsl/el.xml	2011-06-27 09:36:41.978238308 -0500
@@ -1,5 +1,5 @@
-<?xml version="1.0" encoding="utf-8"?>
-<l:l10n xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" language="el" english-language-name="Greek">
+<l:i18n xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0">
+<l:l10n language="el" english-language-name="Greek">
 
    <l:gentext key="footer-doc-comment" text="&#917;&#960;&#953;&#952;&#965;&#956;&#949;&#943;&#964;&#949; &#957;&#945; &#954;&#940;&#957;&#949;&#964;&#949; &#941;&#957;&#945; &#963;&#967;&#972;&#955;&#953;&#959; &#942; &#957;&#945; &#963;&#965;&#957;&#949;&#953;&#963;&#966;&#941;&#961;&#949;&#964;&#949; &#963;&#964;&#959; &#960;&#949;&#961;&#953;&#949;&#967;&#972;&#956;&#949;&#957;&#959; &#945;&#965;&#964;&#942;&#962; &#964;&#951;&#962; &#963;&#949;&#955;&#943;&#948;&#945;&#962;;"/>
    <l:gentext key="footer-doc-feedback" text="&#931;&#964;&#949;&#943;&#955;&#964;&#949; &#964;&#953;&#962; &#963;&#965;&#957;&#949;&#953;&#963;&#966;&#959;&#961;&#941;&#962; &#963;&#945;&#962; &#963;&#964;&#951;&#957; "/>
@@ -53,3 +53,4 @@
       <l:template name="Sun" text="&#922;&#965;&#961;"/>
    </l:context>
 </l:l10n>
+</l:i18n>
diff -up kdelibs-4.6.4/kdoctools/customization/xsl/en.xml.kdoctools_docbook kdelibs-4.6.4/kdoctools/customization/xsl/en.xml
--- kdelibs-4.6.4/kdoctools/customization/xsl/en.xml.kdoctools_docbook	2011-04-01 08:55:50.000000000 -0500
+++ kdelibs-4.6.4/kdoctools/customization/xsl/en.xml	2011-06-27 09:36:41.978238308 -0500
@@ -1,5 +1,5 @@
-<?xml version="1.0" encoding="utf-8"?>
-<l:l10n xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" language="en" english-language-name="English">
+<l:i18n xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0">
+<l:l10n language="en" english-language-name="English">
 
    <l:gentext key="nav-home" text="Contents"/>
 
@@ -7,3 +7,4 @@
    <l:gentext key="footer-doc-feedback" text="Send feedback to the "/>
    <l:gentext key="footer-doc-teamname" text="KDE Docs Team"/>
 </l:l10n>
+</l:i18n>
diff -up kdelibs-4.6.4/kdoctools/customization/xsl/es.xml.kdoctools_docbook kdelibs-4.6.4/kdoctools/customization/xsl/es.xml
--- kdelibs-4.6.4/kdoctools/customization/xsl/es.xml.kdoctools_docbook	2011-04-01 08:55:50.000000000 -0500
+++ kdelibs-4.6.4/kdoctools/customization/xsl/es.xml	2011-06-27 09:36:41.978238308 -0500
@@ -1,6 +1,7 @@
-<?xml version="1.0" encoding="utf-8"?>
-<l:l10n xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" language="es" english-language-name="Spanish">
+<l:i18n xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0">
+<l:l10n language="es" english-language-name="Spanish">
    <l:gentext key="footer-doc-comment" text="&#191;Le gustar&#237;a hacer alg&#250;n comentario o aportar una actualizaci&#243;n a esta p&#225;gina?"/>
    <l:gentext key="footer-doc-feedback" text="Env&#237;e sus comentarios al "/>
    <l:gentext key="footer-doc-teamname" text="equipo de documentaci&#243;n de KDE"/>
 </l:l10n>
+</l:i18n>
diff -up kdelibs-4.6.4/kdoctools/customization/xsl/et.xml.kdoctools_docbook kdelibs-4.6.4/kdoctools/customization/xsl/et.xml
--- kdelibs-4.6.4/kdoctools/customization/xsl/et.xml.kdoctools_docbook	2011-04-01 08:55:50.000000000 -0500
+++ kdelibs-4.6.4/kdoctools/customization/xsl/et.xml	2011-06-27 09:36:41.978238308 -0500
@@ -1,5 +1,5 @@
-<?xml version="1.0" encoding="utf-8"?>
-<l:l10n xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" language="et" english-language-name="Estonian">
+<l:i18n xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0">
+<l:l10n language="et" english-language-name="Estonian">
    <l:gentext key="RevHistory" text="Versioonide ajalugu"/>
    <l:gentext key="revhistory" text="Versioonide ajalugu"/>
    <l:gentext key="revision" text="Versioon"/>
@@ -9,3 +9,4 @@
    <l:gentext key="footer-doc-feedback" text="Saada oma tagasiside "/>
    <l:gentext key="footer-doc-teamname" text="KDE dokumentatsiooni meeskonnale"/>
 </l:l10n>
+</l:i18n>
diff -up kdelibs-4.6.4/kdoctools/customization/xsl/fr.xml.kdoctools_docbook kdelibs-4.6.4/kdoctools/customization/xsl/fr.xml
--- kdelibs-4.6.4/kdoctools/customization/xsl/fr.xml.kdoctools_docbook	2011-04-01 08:55:50.000000000 -0500
+++ kdelibs-4.6.4/kdoctools/customization/xsl/fr.xml	2011-06-27 09:36:41.979238296 -0500
@@ -1,6 +1,7 @@
-<?xml version="1.0" encoding="utf-8"?>
-<l:l10n xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" language="fr" english-language-name="French">
+<l:i18n xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0">
+<l:l10n language="fr" english-language-name="French">
    <l:gentext key="footer-doc-comment" text="Vous souhaitez faire un commentaire ou participer au contenu de cette page&#160;?"/>
    <l:gentext key="footer-doc-feedback" text="Envoyez vos contributions &#224; l'"/>
    <l:gentext key="footer-doc-teamname" text="&#233;quipe de documentation de KDE"/>
 </l:l10n>
+</l:i18n>
diff -up kdelibs-4.6.4/kdoctools/customization/xsl/gl.xml.kdoctools_docbook kdelibs-4.6.4/kdoctools/customization/xsl/gl.xml
--- kdelibs-4.6.4/kdoctools/customization/xsl/gl.xml.kdoctools_docbook	2011-04-01 08:55:50.000000000 -0500
+++ kdelibs-4.6.4/kdoctools/customization/xsl/gl.xml	2011-06-27 09:36:41.979238296 -0500
@@ -1,6 +1,7 @@
-<?xml version="1.0" encoding="utf-8"?>
-<l:l10n xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" language="gl" english-language-name="Galician">
+<l:i18n xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0">
+<l:l10n language="gl" english-language-name="Galician">
 <l:gentext key="footer-doc-comment" text="Desexa facer un comentario ou actualizar esta pÃ¡xina?"/>
 <l:gentext key="footer-doc-feedback" text="EnvÃ­e as sÃºas aportaciÃ³ns Ã¡ "/>
 <l:gentext key="footer-doc-teamname" text="Equipa de documentaciÃ³n de KDE"/>
 </l:l10n>
+</l:i18n>
diff -up kdelibs-4.6.4/kdoctools/customization/xsl/it.xml.kdoctools_docbook kdelibs-4.6.4/kdoctools/customization/xsl/it.xml
--- kdelibs-4.6.4/kdoctools/customization/xsl/it.xml.kdoctools_docbook	2011-04-01 08:55:50.000000000 -0500
+++ kdelibs-4.6.4/kdoctools/customization/xsl/it.xml	2011-06-27 09:36:41.979238296 -0500
@@ -1,5 +1,5 @@
-<?xml version="1.0" encoding="utf-8"?>
-<l:l10n xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" language="it" english-language-name="Italian">
+<l:i18n xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0">
+<l:l10n language="it" english-language-name="Italian">
    <l:dingbat key="startquote" text="&#171;"/>
    <l:dingbat key="endquote" text="&#187;"/>
    <l:dingbat key="nestedstartquote" text="&#8220;"/>
@@ -46,3 +46,4 @@
       <l:template name="table" text="Tabella&#160;%n, &#171;%t&#187;"/>
    </l:context>
 </l:l10n>
+</l:i18n>
diff -up kdelibs-4.6.4/kdoctools/customization/xsl/lt.xml.kdoctools_docbook kdelibs-4.6.4/kdoctools/customization/xsl/lt.xml
--- kdelibs-4.6.4/kdoctools/customization/xsl/lt.xml.kdoctools_docbook	2011-04-01 08:55:50.000000000 -0500
+++ kdelibs-4.6.4/kdoctools/customization/xsl/lt.xml	2011-06-27 09:36:41.979238296 -0500
@@ -1,6 +1,7 @@
-<?xml version="1.0" encoding="utf-8"?>
-<l:l10n xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" language="lt" english-language-name="Lithuanian">
+<l:i18n xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0">
+<l:l10n language="lt" english-language-name="Lithuanian">
    <l:gentext key="footer-doc-comment" text="Ar nor&#279;tum&#279;te pakomentuoti ar atnaujinti &#353;&#303; puslap&#303;?"/>
    <l:gentext key="footer-doc-feedback" text="Atsiliepimus si&#371;skite "/>
    <l:gentext key="footer-doc-teamname" text="KDE dokumentacijos komanda"/>
 </l:l10n>
+</l:i18n>
diff -up kdelibs-4.6.4/kdoctools/customization/xsl/nl.xml.kdoctools_docbook kdelibs-4.6.4/kdoctools/customization/xsl/nl.xml
--- kdelibs-4.6.4/kdoctools/customization/xsl/nl.xml.kdoctools_docbook	2011-04-01 08:56:18.000000000 -0500
+++ kdelibs-4.6.4/kdoctools/customization/xsl/nl.xml	2011-06-27 09:37:46.817427707 -0500
@@ -1,5 +1,5 @@
-<?xml version="1.0" encoding="utf-8"?>
-<l:l10n xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" language="nl" english-language-name="Dutch">
+<l:i18n xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0">
+<l:l10n language="nl" english-language-name="Dutch">
    <l:gentext key="footer-doc-comment" text="Wilt u een opmerking maken of  een bijdragen leveren aan deze pagina?"/>
    <l:gentext key="footer-doc-feedback" text="Stuur uw bericht aan het "/>
    <l:gentext key="footer-doc-teamname" text="KDE Documentatieteam"/>
diff -up kdelibs-4.6.4/kdoctools/customization/xsl/nn.xml.kdoctools_docbook kdelibs-4.6.4/kdoctools/customization/xsl/nn.xml
--- kdelibs-4.6.4/kdoctools/customization/xsl/nn.xml.kdoctools_docbook	2011-04-01 08:55:50.000000000 -0500
+++ kdelibs-4.6.4/kdoctools/customization/xsl/nn.xml	2011-06-27 09:36:41.980238284 -0500
@@ -1,5 +1,5 @@
-<?xml version="1.0" encoding="utf-8"?>
-<l:l10n xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" language="nn" english-language-name="Norwegian Nynorsk">
+<l:i18n xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0">
+<l:l10n language="nn" english-language-name="Norwegian Nynorsk">
 
    <l:gentext key="abstract" text="samandrag"/>
    <l:gentext key="Bibliography" text="Litteratur"/>
@@ -200,3 +200,4 @@
    </l:context>
 
 </l:l10n>
+</l:i18n>
diff -up kdelibs-4.6.4/kdoctools/customization/xsl/pl.xml.kdoctools_docbook kdelibs-4.6.4/kdoctools/customization/xsl/pl.xml
--- kdelibs-4.6.4/kdoctools/customization/xsl/pl.xml.kdoctools_docbook	2011-04-01 08:55:50.000000000 -0500
+++ kdelibs-4.6.4/kdoctools/customization/xsl/pl.xml	2011-06-27 09:36:41.980238284 -0500
@@ -1,6 +1,7 @@
-<?xml version="1.0" encoding="utf-8"?>
-<l:l10n xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" language="pl" english-language-name="Polish">
+<l:i18n xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0">
+<l:l10n language="pl" english-language-name="Polish">
    <l:gentext key="footer-doc-comment" text="Je&#347;li chcesz skomentowa&#263; t&#261; stron&#281; lub j&#261; uaktualni&#263; "/>
    <l:gentext key="footer-doc-feedback" text="Wy&#347;lij swoje uwagi (po angielsku) do "/>
    <l:gentext key="footer-doc-teamname" text="Zespo&#322;u dokumentacji KDE"/>
 </l:l10n>
+</l:i18n>
diff -up kdelibs-4.6.4/kdoctools/customization/xsl/pt_br.xml.kdoctools_docbook kdelibs-4.6.4/kdoctools/customization/xsl/pt_br.xml
--- kdelibs-4.6.4/kdoctools/customization/xsl/pt_br.xml.kdoctools_docbook	2011-04-01 08:55:50.000000000 -0500
+++ kdelibs-4.6.4/kdoctools/customization/xsl/pt_br.xml	2011-06-27 09:36:41.981238272 -0500
@@ -1,6 +1,7 @@
-<?xml version="1.0" encoding="utf-8"?>
-<l:l10n xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" language="pt_br" english-language-name="Portuguese (Brazil)">
+<l:i18n xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0">
+<l:l10n language="pt_br" english-language-name="Portuguese (Brazil)">
    <l:gentext key="footer-doc-comment" text="Gostaria de fazer um coment&#225;rio ou contribuir com uma atualiza&#231;&#227;o para esta p&#225;gina?"/>
    <l:gentext key="footer-doc-feedback" text="Envie uma mensagem para a "/>
    <l:gentext key="footer-doc-teamname" text="Equipe de Documenta&#231;&#227;o do KDE"/>
 </l:l10n>
+</l:i18n>
diff -up kdelibs-4.6.4/kdoctools/customization/xsl/pt.xml.kdoctools_docbook kdelibs-4.6.4/kdoctools/customization/xsl/pt.xml
--- kdelibs-4.6.4/kdoctools/customization/xsl/pt.xml.kdoctools_docbook	2011-04-01 08:55:50.000000000 -0500
+++ kdelibs-4.6.4/kdoctools/customization/xsl/pt.xml	2011-06-27 09:36:41.980238284 -0500
@@ -1,6 +1,7 @@
-<?xml version="1.0" encoding="utf-8"?>
-<l:l10n xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" language="pt" english-language-name="Portuguese">
+<l:i18n xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0">
+<l:l10n language="pt" english-language-name="Portuguese">
    <l:gentext key="footer-doc-comment" text="Would you like to make a comment or contribute an update to this page?"/>
    <l:gentext key="footer-doc-feedback" text="Send feedback to the "/>
    <l:gentext key="footer-doc-teamname" text="KDE Docs Team"/>
 </l:l10n>
+</l:i18n>
diff -up kdelibs-4.6.4/kdoctools/customization/xsl/ru.xml.kdoctools_docbook kdelibs-4.6.4/kdoctools/customization/xsl/ru.xml
--- kdelibs-4.6.4/kdoctools/customization/xsl/ru.xml.kdoctools_docbook	2011-04-01 08:55:50.000000000 -0500
+++ kdelibs-4.6.4/kdoctools/customization/xsl/ru.xml	2011-06-27 09:36:41.981238272 -0500
@@ -1,6 +1,7 @@
-<?xml version="1.0" encoding="utf-8"?>
-<l:l10n xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" language="ru" english-language-name="Russian">
+<l:i18n xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0">
+<l:l10n language="ru" english-language-name="Russian">
    <l:gentext key="footer-doc-comment" text="ÐÐ°Ð¼ ÐµÑÑÑ ÑÑÐ¾ Ð´Ð¾Ð±Ð°Ð²Ð¸ÑÑ Ð½Ð° ÑÑÑ ÑÑÑÐ°Ð½Ð¸ÑÑ?"/>
    <l:gentext key="footer-doc-feedback" text="ÐÐ°Ð¿Ð¸ÑÐ¸ÑÐµ "/>
    <l:gentext key="footer-doc-teamname" text="ÐºÐ¾Ð¼Ð°Ð½Ð´Ðµ Ð´Ð¾ÐºÑÐ¼ÐµÐ½ÑÐ°ÑÐ¸Ð¸ KDE"/>
 </l:l10n>
+</l:i18n>
diff -up kdelibs-4.6.4/kdoctools/customization/xsl/sl.xml.kdoctools_docbook kdelibs-4.6.4/kdoctools/customization/xsl/sl.xml
--- kdelibs-4.6.4/kdoctools/customization/xsl/sl.xml.kdoctools_docbook	2011-04-01 08:55:50.000000000 -0500
+++ kdelibs-4.6.4/kdoctools/customization/xsl/sl.xml	2011-06-27 09:36:41.981238272 -0500
@@ -1,5 +1,5 @@
-<?xml version="1.0" encoding="utf-8"?>
-<l:l10n xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" language="sl" english-language-name="Slovenian">
+<l:i18n xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0">
+<l:l10n language="sl" english-language-name="Slovenian">
 
    <l:gentext key="PubDate" text="Datum objave"/>
    <l:gentext key="pubdate" text="Datum objave"/>
@@ -119,3 +119,4 @@
    </l:context>
 
 </l:l10n>
+</l:i18n>
diff -up kdelibs-4.6.4/kdoctools/customization/xsl/sr.xml.kdoctools_docbook kdelibs-4.6.4/kdoctools/customization/xsl/sr.xml
--- kdelibs-4.6.4/kdoctools/customization/xsl/sr.xml.kdoctools_docbook	2011-04-01 08:55:50.000000000 -0500
+++ kdelibs-4.6.4/kdoctools/customization/xsl/sr.xml	2011-06-27 09:36:41.982238259 -0500
@@ -1,6 +1,5 @@
-<?xml version="1.0" encoding="utf-8"?>
-<l:l10n xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0"
-        language="sr"
+<l:i18n xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0">
+<l:l10n language="sr"
         english-language-name="Serbian">
 
 <l:gentext key="Abstract" text="Ð¡Ð°Ð¶ÐµÑÐ°Ðº"/>
@@ -692,3 +691,4 @@
 <l:l i="56">z</l:l>
 </l:letters>
 </l:l10n>
+</l:i18n>
diff -up kdelibs-4.6.4/kdoctools/customization/xsl/sv.xml.kdoctools_docbook kdelibs-4.6.4/kdoctools/customization/xsl/sv.xml
--- kdelibs-4.6.4/kdoctools/customization/xsl/sv.xml.kdoctools_docbook	2011-04-01 08:55:50.000000000 -0500
+++ kdelibs-4.6.4/kdoctools/customization/xsl/sv.xml	2011-06-27 09:36:41.982238259 -0500
@@ -1,6 +1,7 @@
-<?xml version="1.0" encoding="utf-8"?>
-<l:l10n xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" language="sv" english-language-name="Swedish">
+<l:i18n xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0">
+<l:l10n language="sv" english-language-name="Swedish">
    <l:gentext key="footer-doc-comment" text="Vill du ge en kommentar eller bidra med en uppdatering av den h&#228;r sidan?"/>
    <l:gentext key="footer-doc-feedback" text="Skicka dina f&#246;rslag till "/>
    <l:gentext key="footer-doc-teamname" text="KDE:s dokumentationsgrupp"/>
 </l:l10n>
+</l:i18n>
diff -up kdelibs-4.6.4/kdoctools/customization/xsl/tr.xml.kdoctools_docbook kdelibs-4.6.4/kdoctools/customization/xsl/tr.xml
--- kdelibs-4.6.4/kdoctools/customization/xsl/tr.xml.kdoctools_docbook	2011-04-01 08:55:50.000000000 -0500
+++ kdelibs-4.6.4/kdoctools/customization/xsl/tr.xml	2011-06-27 09:36:41.982238259 -0500
@@ -1,6 +1,7 @@
-<?xml version="1.0" encoding="utf-8"?>
-<l:l10n xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" language="tr" english-language-name="Turkish">
+<l:i18n xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0">
+<l:l10n language="tr" english-language-name="Turkish">
    <l:gentext key="footer-doc-comment" text="Bu sayfa hakk&#305;nda bir yorum yapmak ya da katk&#305;da bulunmak ister misniz?"/>
    <l:gentext key="footer-doc-feedback" text="Geribildirimlerinizi g&#246;nderin "/>
    <l:gentext key="footer-doc-teamname" text="KDE Belgelendirme Ekibi"/>
 </l:l10n>
+</l:i18n>
diff -up kdelibs-4.6.4/kdoctools/customization/xsl/uk.xml.kdoctools_docbook kdelibs-4.6.4/kdoctools/customization/xsl/uk.xml
--- kdelibs-4.6.4/kdoctools/customization/xsl/uk.xml.kdoctools_docbook	2011-04-01 08:55:50.000000000 -0500
+++ kdelibs-4.6.4/kdoctools/customization/xsl/uk.xml	2011-06-27 09:36:41.982238259 -0500
@@ -1,5 +1,5 @@
-<?xml version="1.0" encoding="utf-8"?>
-<l:l10n xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" language="uk" english-language-name="Ukranian">
+<l:i18n xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0">
+<l:l10n language="uk" english-language-name="Ukranian">
 
    <l:gentext key="Bibliography" text="&#1051;&#1110;&#1090;&#1077;&#1088;&#1072;&#1090;&#1091;&#1088;&#1072;"/>
    <l:gentext key="bibliography" text="&#1083;&#1110;&#1090;&#1077;&#1088;&#1072;&#1090;&#1091;&#1088;&#1072;"/>
@@ -33,3 +33,4 @@
    <l:gentext key="footer-doc-teamname" text="&#1050;&#1086;&#1084;&#1072;&#1085;&#1076;&#1080; &#1079; &#1076;&#1086;&#1082;&#1091;&#1084;&#1077;&#1085;&#1090;&#1091;&#1074;&#1072;&#1085;&#1085;&#1103; KDE"/>
 
 </l:l10n>
+</l:i18n>
diff -up kdelibs-4.6.4/kdoctools/docbookl10nhelper.cpp.kdoctools_docbook kdelibs-4.6.4/kdoctools/docbookl10nhelper.cpp
--- kdelibs-4.6.4/kdoctools/docbookl10nhelper.cpp.kdoctools_docbook	2011-04-01 08:55:50.000000000 -0500
+++ kdelibs-4.6.4/kdoctools/docbookl10nhelper.cpp	2011-06-27 09:36:41.983238246 -0500
@@ -85,6 +85,39 @@ int writeLangFile( const QString &fname,
    return( 0 );
 }
 
+int writeLangFileNew( const QString &fname, const QString &dtdPath,
+                      const LangListType &langMap ) {
+
+   QFile outFile( fname );
+   if ( ! outFile.open( QIODevice::WriteOnly ) ) {
+      qCritical() << QString( "Could not write %1" )
+                     .arg( outFile.fileName() );
+      return( 1 );
+   }
+
+   QTextStream outStream( &outFile );
+   outStream << "<?xml version='1.0'?>" << endl;
+   outStream << QString( "<!DOCTYPE l:i18n SYSTEM \"%1\">" )
+               .arg( dtdPath ) << endl;
+
+   if ( langMap.size() > 0 ) {
+      outStream
+         << "<l:i18n xmlns:l=\"http://docbook.sourceforge.net/xmlns/l10n/1.0\">"
+         << endl;
+      LangListType::const_iterator i = langMap.constBegin();
+      while ( i != langMap.constEnd() ) {
+         outStream << QString( "<l:l10n language=\"%1\" href=\"%2\"/>" )
+                      .arg( (*i).first ).arg( (*i).second ) << endl;
+         ++i;
+      }
+      outStream << "</l:i18n>" << endl;
+   }
+
+   outFile.close();
+
+   return( 0 );
+}
+
 inline const QString addTrailingSlash( const QString &p ) {
    return p.endsWith( "/" ) ? p : p + "/";
 }
@@ -199,11 +232,16 @@ int main( int argc, char **argv ) {
       ++i;
    }
 
+   int res = 0;
 
-   int res = writeLangFile( all10nFName, l10nDir + "common/l10n.dtd",
-                            allLangs );
-   res += writeLangFile( customl10nFName, l10nDir + "common/l10n.dtd",
-                         customLangs );
+   if ( foundRxEntity ) {
+      /* old style (docbook-xsl<=1.75) */
+      res = writeLangFile( all10nFName, l10nDir + "common/l10n.dtd",
+                           allLangs );
+   } else {
+      res = writeLangFileNew( all10nFName, l10nDir + "common/l10n.dtd",
+                              allLangs );
+   }
 
    return( res );
 }
