diff -up kdegraphics-4.6.1/gwenview/lib/CMakeLists.txt.libjpeg_version kdegraphics-4.6.1/gwenview/lib/CMakeLists.txt
--- kdegraphics-4.6.1/gwenview/lib/CMakeLists.txt.libjpeg_version	2011-01-18 15:25:18.000000000 -0600
+++ kdegraphics-4.6.1/gwenview/lib/CMakeLists.txt	2011-03-03 13:12:43.014238970 -0600
@@ -1,16 +1,21 @@
 project(gwenviewlib)
 
-# Extract version of libjpeg so that we can use the appropriate dir
+# check version of libjpeg so that we can use the appropriate dir
 # See bug #227313
-file(READ "${JPEG_INCLUDE_DIR}/jpeglib.h" jpeglib_h_content)
-string(REGEX REPLACE ".*#define +JPEG_LIB_VERSION +([0-9]+).*" "\\1" jpeglib_version "${jpeglib_h_content}")
-message(STATUS "libjpeg version: ${jpeglib_version}")
-
-if ("${jpeglib_version}" LESS 80)
-	set(GV_JPEG_DIR libjpeg-62)
-else ("${jpeglib_version}" LESS 80)
-	set(GV_JPEG_DIR libjpeg-80)
-endif ("${jpeglib_version}" LESS 80)
+set(_jpeglib_version_source "#include <stddef.h>\n#include<stdio.h>\n#include <jpeglib.h>\n int main()\n {\n #if (JPEG_LIB_VERSION >= 80) \n #error JPEG_LIB_VERSION >= 80 found \n #endif \n }\n")
+set(_jpeglib_version_source_file ${CMAKE_BINARY_DIR}/CMakeTmp/cmake_jpeglib_version_check.cpp)
+file(WRITE "${_jpeglib_version_source_file}" "${_jpeglib_version_source}")
+set(_jpeglib_version_include_dirs "-DINCLUDE_DIRECTORIES:STRING=${JPEG_INCLUDE_DIR}")
+
+try_compile(_jpeglib_version_compile_result ${CMAKE_BINARY_DIR} ${_jpeglib_version_source_file} CMAKE_FLAGS "${_jpeglib_version_include_dirs}" COMPILE_OUTPUT_VARIABLE _jpeglib_version_compile_output_var)
+
+if(_jpeglib_version_compile_result)
+MESSAGE(STATUS "Identified libjpeg version: 62")
+set(GV_JPEG_DIR libjpeg-62)
+else(_jpeglib_version_compile_result)
+MESSAGE(STATUS "Identified libjpeg version: 80+")
+set(GV_JPEG_DIR libjpeg-80)
+endif(_jpeglib_version_compile_result)
 
 include_directories(
 	${CMAKE_CURRENT_SOURCE_DIR}/${GV_JPEG_DIR}
