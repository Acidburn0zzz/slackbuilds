From eeef90fc5196c5056c8c4ada7b1b5d74db1e5c94 Mon Sep 17 00:00:00 2001
From: Dirk Mueller <mueller@kde.org>
Date: Fri, 10 Jun 2011 10:28:19 +0200
Subject: [PATCH 4/5] avoid crash when ConsoleKit is unavailable

---
 core/polkitqt1-authority.cpp |   14 ++++++++------
 1 files changed, 8 insertions(+), 6 deletions(-)

diff --git a/core/polkitqt1-authority.cpp b/core/polkitqt1-authority.cpp
index d112031..0951d97 100644
--- a/core/polkitqt1-authority.cpp
+++ b/core/polkitqt1-authority.cpp
@@ -219,12 +219,14 @@ void Authority::Private::init()
     // then we need to extract all seats from ConsoleKit
     QDBusMessage msg = QDBusMessage::createMethodCall(consoleKitService, consoleKitManagerPath, consoleKitManagerInterface, "GetSeats");
     msg = QDBusConnection::systemBus().call(msg);
-    // this method returns a list with present seats
-    QList<QString> seats;
-    qVariantValue<QDBusArgument> (msg.arguments()[0]) >> seats;
-    // it can be multiple seats present so connect all their signals
-    Q_FOREACH(const QString &seat, seats) {
-        seatSignalsConnect(seat);
+    if (!msg.arguments().isEmpty()) {
+        // this method returns a list with present seats
+        QList<QString> seats;
+        qVariantValue<QDBusArgument> (msg.arguments()[0]) >> seats;
+        // it can be multiple seats present so connect all their signals
+        Q_FOREACH(const QString &seat, seats) {
+            seatSignalsConnect(seat);
+        }
     }
 }
 
-- 
1.7.7.4

