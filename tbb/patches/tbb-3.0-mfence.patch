--- tbb30_20110427oss/include/tbb/machine/linux_ia32.h.orig	2011-05-10 07:29:02.000000000 -0300
+++ tbb30_20110427oss/include/tbb/machine/linux_ia32.h	2011-05-31 23:01:19.441220717 -0300
@@ -37,7 +37,13 @@
 #define __TBB_BIG_ENDIAN 0
 
 #define __TBB_release_consistency_helper() __asm__ __volatile__("": : :"memory")
-#define __TBB_full_memory_fence() __asm__ __volatile__("mfence": : :"memory")
+#define __TBB_full_memory_fence() {
+  int tmp;
+  __asm__ __volatile__("xchg %0,%0"
+		       : "=r"(tmp)
+		       : "r"(tmp)
+		       : "memory");
+}
 
 #if __TBB_ICC_ASM_VOLATILE_BROKEN
 #define __TBB_VOLATILE
